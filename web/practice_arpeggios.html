<!DOCTYPE html>
<html>
<head>
    <title>Guitar Arpeggio Practice Tool</title>
    <style>
        table, th, td {
          border: 1px solid black;
          border-collapse: collapse;
        }
        button {
          width: 50px;
          height: 50px;
        }
    </style>
</head>
<body>
    <h1>Guitar Arpeggio Practice Tool</h1>
    <p id="quiz-info"></p>
    <table id="grid"></table>
    <button onclick="startNewRound()">Start New Round</button>
    <script>
        const chordNotes = {
            'major 7': ['1', '3', '5', '7', '1'],
            'minor 7': ['1', 'b3', '5', 'b7', '1'],
            'dominant 7': ['1', '3', '5', 'b7', '1'],
            'half diminished 7': ['1', 'b3', 'b5', 'b7', '1'],
        };

        const arpeggios = {
            'major 7': [
                [[5, 0], [5, 4], [4, 2], [3, 1], [3, 2]], // R6F1
                [[5, 2], [4, 1], [4, 4], [3, 3], [3, 4]], // R6F2
                [[5, 3], [4, 2], [3, 0], [3, 4], [2, 0]], // R6F4
                [[4, 0], [4, 4], [3, 2], [2, 1], [2, 2]], // R5F1
                [[4, 2], [3, 1], [3, 4], [2, 3], [2, 4]], // R5F2
                [[4, 3], [3, 2], [2, 0], [2, 4], [1, 1]], // R5F4
                [[3, 0], [3, 4], [2, 2], [1, 2], [1, 3]], // R4F1
                [[3, 2], [2, 1], [2, 4], [1, 4], [0, 0]], // R4F2
                [[3, 3], [2, 2], [1, 1], [0, 0], [0, 1]], // R4F4
                [[2, 0], [1, 0], [1, 3], [0, 2], [0, 3]], // R3F1
                [[2, 2], [1, 2], [0, 0], [0, 4], [0, 5]], // R3F2 or R3F3
                [[1, 0], [1, 4], [0, 2],  null ,  null ], // R2F1
                [[1, 2], [0, 1], [0, 4],  null ,  null ], // R2F2 or R2F3
                [ null , [5, 2], [4, 0], [4, 4], [3, 0]], // R4F1 (down only)
                [ null , [5, 0], [5, 3], [4, 2], [4, 3]], // R5F4 or R5F3 (down only)
                [ null ,  null , [5, 0], [5, 4], [4, 0]], // R5F1 (down only)
            ],
            'minor 7': [
                [[5, 0], [5, 3], [4, 2], [3, 0], [3, 2]], // R6F1
                [[5, 2], [4, 0], [4, 4], [3, 2], [3, 4]], // R6F2
                [[5, 3], [4, 1], [3, 0], [3, 3], [2, 0]], // R6F4
                [[4, 0], [4, 3], [3, 2], [2, 0], [2, 2]], // R5F1
                [[4, 2], [3, 0], [3, 4], [2, 2], [2, 4]], // R5F2
                [[4, 3], [3, 1], [2, 0], [2, 3], [1, 1]], // R5F4
            ],
            'dominant 7': [
                [[5, 0], [5, 4], [4, 2], [3, 0], [3, 2]], // R6F1
                [[5, 2], [4, 1], [4, 4], [3, 2], [3, 4]], // R6F2
                [[5, 3], [4, 2], [3, 0], [3, 3], [2, 0]], // R6F4
                [[4, 0], [4, 4], [3, 2], [2, 0], [2, 2]], // R5F1
                [[4, 2], [3, 1], [3, 4], [2, 2], [2, 4]], // R5F2
            ],
            'half diminished 7': [
                [[5, 0], [5, 3], [4, 1], [3, 0], [3, 2]], // R6F1
                [[5, 2], [4, 0], [4, 3], [3, 2], [3, 4]], // R6F2
                [[5, 4], [4, 2], [3, 0], [3, 4], [2, 1]], // R6F4
                [[4, 0], [4, 3], [3, 1], [2, 0], [2, 2]], // R5F1
                [[4, 2], [3, 0], [3, 3], [2, 2], [2, 4]], // R5F2
            ],
        };

        let grid = [...Array(6)].map(() => Array(6).fill(''));
        let currentQuiz = [];
        let quizIndex = 0;

        const table = document.getElementById('grid');
        for (let i = 0; i < 6; i++) {
            const row = table.insertRow();
            for (let j = 0; j < 6; j++) {
                const cell = row.insertCell();
                const button = document.createElement('button');
                button.id = `cell-${i}-${j}`;
                button.addEventListener('click', () => handleButtonClick(i, j));
                cell.appendChild(button);
            }
        }

        function generateQuiz(chord, arpeggio) {
            return arpeggio.filter(item => item !== null).map((position, index) => {
                return {
                    note: chord[index],
                    position: position,
                };
            });
        }

        function handleButtonClick(i, j) {
            const button = document.getElementById(`cell-${i}-${j}`);
            const currentNote = currentQuiz[quizIndex];

            if (currentNote.position[0] === i && currentNote.position[1] === j) {
                button.innerText = currentNote.note;
                quizIndex += 1;
                if (quizIndex >= currentQuiz.length) {
                    // alert('Completed! Start a new round.');
                    startNewRound();
                }
            } else {
                alert('Incorrect! Try again.');
            }
        }

        function startNewRound() {
            // Clear grid
            for (let i = 0; i < 6; i++) {
                for (let j = 0; j < 6; j++) {
                    const button = document.getElementById(`cell-${i}-${j}`);
                    button.innerText = '';
                }
            }

            // Randomly select a chordNotes and an arpeggio
            const chordKeys = Object.keys(chordNotes);
            const selectedChord = chordKeys[Math.floor(Math.random() * chordKeys.length)];
            const selectedChordNotes = [...chordNotes[selectedChord]]; 
            const selectedArpeggios = arpeggios[selectedChord];
            const selectedArpeggio = selectedArpeggios[Math.floor(Math.random() * selectedArpeggios.length)];

            // random direction
            const isUpward = Math.random() >= 0.5;

            if (isUpward) {
                if (selectedArpeggio[0] === null) {
                    selectedArpeggio.reverse();
                    selectedChordNotes.reverse();
                    isUpward = false;
                }
            } else {
                if (selectedArpeggio[selectedArpeggio.length - 1] === null) {
                    isUpward = true;
                } else {
                    selectedArpeggio.reverse();
                    selectedChordNotes.reverse();
                }
            }

            // Generate quiz
            currentQuiz = generateQuiz(selectedChordNotes, selectedArpeggio);
            quizIndex = 0;

            // Show the first note of the quiz on the button grid
            handleButtonClick(currentQuiz[0].position[0], currentQuiz[0].position[1]);

            // Show quiz info
            const direction = isUpward ? 'Upward' : 'Downward';
            document.getElementById('quiz-info').innerText = `Chord: ${selectedChord}, Direction: ${direction}`;
        }
    </script>
</body>
</html>